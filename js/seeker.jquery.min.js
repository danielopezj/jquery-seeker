var __jquerySeekerPluginAjaxCache=[];
(function(j){var k=function(){};k.prototype.indexOf=function(d,b){var a;for(a=0;a<b.length;a++)if(k.prototype.deepEqual(b[a],d))return a;return-1};k.prototype.deepEqual=function(d,b){if(d===b)return!0;if(!(d instanceof Object)||!(b instanceof Object)||d.constructor!==b.constructor)return!1;for(var a in d)if(d.hasOwnProperty(a)&&(!b.hasOwnProperty(a)||d[a]!==b[a]&&("object"!==typeof d[a]||!k.prototype.deepEqual(d[a],b[a]))))return!1;for(a in b)if(b.hasOwnProperty(a)&&!d.hasOwnProperty(a))return!1;
return!0};k.prototype.clamp=function(d,b,a){return d<b?b:d>a?a:d};k.prototype.parseField=function(d,b){return 0===b||d.length<b?d:d.substring(0,b)+"..."};j.fn.seeker=function(d){var b,a,o,e,h,g,p,c,q,l,m;this.settings=j.extend({source:[],seekField:null,url:void 0,method:"POST",onSelected:void 0,visibleFields:[],order:"ASC",peerSeeker:null,width:200,autocompleteInterval:2E3,orderBy:void 0,maxFieldLength:0,dropDownSameWidth:!0,columnsWidth:[]},d);this.id=this.attr("id");this.source=[];this.filteredSource=
[];this.selectedIndex=-1;if(null===this.settings.seekField)throw"Seek Field not found";if(this.settings.source===[]&&void 0===this.settings.url)throw"Source not specified";this.getSelectedItem=function(){if(-1<this.selectedIndex)return this.source[this.selectedIndex]};this.setSelectedItem=function(f){var c,b,d;d=new k;c=d.indexOf(f,this.source);if(-1<c){b=this.source[c];this.val(b[this.settings.seekField]);this._buildTable(this.source);this.filteredSource=[];l&&clearInterval(l);if(this.settings.onSelected)this.settings.onSelected(c,
b);this.selectedIndex=c}b=a.parent().outerHeight()/2;a.parent().scrollTop(a.parent()[0].scrollHeight*(c/this.source.length)-b);a=j("#"+this.id+"-table").hide();this._buildTable(this.source);this.settings.peerSeeker&&!d.deepEqual(this.settings.peerSeeker.getSelectedItem(),f)&&this.settings.peerSeeker.setSelectedItem(f)};this.setSelectedIndex=function(f){this.source[f]&&this.setSelectedItem(this.source[f])};this.getSelectedIndex=function(){return this.selectedIndex};this.setPeerSeeker=function(f){this.settings.peerSeeker=
f};this.setSource=function(f){this.settings.source=f;this.source=[];this.selectedIndex=-1;for(b=0;b<this.settings.source.length;b++)this.source.push(this.settings.source[b]);this._buildTable(this.source);this.val("")};this._filterSource=function(f){var c,b;this.filteredSource=[];f=f.toLowerCase();for(c=0;c<this.source.length;c++)b=this.source[c][this.settings.seekField].toString().toLowerCase(),0===b.indexOf(f)&&this.filteredSource.push(this.source[c]);this._buildTable(this.filteredSource)};this._updateScroll=
function(c,b,a){var d=c.parent().outerHeight()/2;c.parent().scrollTop(c.parent()[0].scrollHeight*(b/a)-d)};this._buildTable=function(b){var a,d,e,i,g,h,l,m,n;m=new k;h=j("#"+this.id+"-table");h.empty();if(0<this.settings.columnsWidth.length){for(e=a=0;e<this.settings.columnsWidth.length;e++)a+=this.settings.columnsWidth[e];h.css("width",a+"px")}for(e=0;e<b.length;e++){a="<tr "+(-1<this.selectedIndex&&e===this.selectedIndex?'class="seeker-selected"':"")+' id="'+o+"-"+e+'">';d=b[e];if(0<this.settings.visibleFields.length)for(l in i=
1,this.settings.visibleFields)n="",void 0!==this.settings.columnsWidth[i-1]&&(n=' width="'+this.settings.columnsWidth[i-1]+'" '),d[this.settings.visibleFields[l]]&&(a+='<td class="col-'+i+'" '+n+">"+m.parseField(d[this.settings.visibleFields[l]],this.settings.maxFieldLength)+"</td>",i++);else for(g in n="",this.settings.columnsWidth&&this.settings.columnsWidth[0]&&(n=' width="'+this.settings.columnsWidth[0]+'" '),a+='<td class="col-1" '+n+">"+m.parseField(d[this.settings.seekField],this.settings.maxFieldLength)+
"</td>",i=1,d)n="",void 0!==this.settings.columnsWidth[i]&&(n=' width="'+this.settings.columnsWidth[i]+'" '),d[g]&&g!==this.settings.seekField&&(a+='<td class="col-'+i+'" '+n+">"+m.parseField(d[g],this.settings.maxFieldLength)+"</td>",i++);a+="</tr>";h.append(a)}j("#"+o+"-table tr").bind("click",function(){var a=this.id.split("-")[1],a=0<c.filteredSource.length?c.filteredSource[a]:c.source[a];c.setSelectedItem(a);c.settings.peerSeeker&&c.settings.peerSeeker.setSelectedItem(a)})};this._checkForAutocomplete=
function(){var b,d,e=c.val();for(b=0;b<c.source.length;b++)if(d=c.source[b][c.settings.seekField].toString().toLowerCase(),0===d.indexOf(e)){b=c.source[b];c.setSelectedItem(b);c.settings.peerSeeker&&c.settings.peerSeeker.setSelectedItem(b);a.hide();break}};o=this.id;c=this;if(this.settings.url){var r=this.settings.url+"."+this.settings.method;__jquerySeekerPluginAjaxCache[r]?(d=__jquerySeekerPluginAjaxCache[r],c.settings.source=d,c.source=d):j.ajax({type:this.settings.method,contentType:"application/json; charset=utf-8",
url:this.settings.url,dataType:"json",async:!1,success:function(a){c.settings.source=a;c.source=a;__jquerySeekerPluginAjaxCache[r]=a}})}else for(b=0;b<this.settings.source.length;b++)this.source.push(this.settings.source[b]);null!==this.settings.order&&(b=this.settings.orderBy||this.settings.seekField,q="DESC"===this.settings.order,this.source.sort(function(a,c){return a[b]===c[b]?0:q&&a[b]>c[b]||!q&&a[b]<c[b]?-1:1}));this.addClass("seeker-text");this.wrap('<div class="seeker-container" />');this.after('<div class="seeker-table-container"><table class="seeker-outter" id="'+
o+'-table"></table></div>');this.css("width",this.settings.width);a=j("#"+o+"-table");d=a.parent();this.settings.dropDownSameWidth&&a.width(this.width());this._buildTable(this.source);p=m=g=h=!1;this.after('<input type="button" value="" id="'+o+'-button" class="seeker-button" />');e=j("#"+o+"-button");this.bind("mouseenter",function(){g=true;e.show()});this.bind("mouseleave",function(){g=false;h||e.hide();m||a.hide()});this.bind("focus",function(){h=true;e.show()});this.bind("blur",function(){h=false;
g||e.hide();if(p){p=false;a.hide()}});e.bind("mouseenter",function(){g=true;e.show()});e.bind("mouseleave",function(){g=false;h||e.hide()});e.bind("click",function(){if(c.filteredSource.length>0){c.filteredSource=[];c._buildTable(c.source)}if(a.css("display")==="none"){a.show();c._updateScroll(a,c.selectedIndex,c.source.length)}else a.hide()});d.bind("mouseenter",function(){m=true;a.show()});d.bind("mouseleave",function(){m=false;!h&&!g&&a.hide()});this.bind("keyup",function(b){if(b.keyCode===40||
b.keyCode===38){b=c.selectedIndex+(b.keyCode===40?1:-1);b=(new k).clamp(b,0,c.source.length-1);c.setSelectedItem(c.source[b]);a.show();c._updateScroll(a,c.selectedIndex,c.source.length);c.settings.peerSeeker&&c.settings.peerSeeker.setSelectedItem(c.source[b])}else if(b.keyCode===13)a.hide();else{c._filterSource(j(this).val());a.show();if(c.settings.autocompleteInterval>0){l&&clearInterval(l);l=setInterval(c._checkForAutocomplete,c.settings.autocompleteInterval)}}});return this}})(jQuery);