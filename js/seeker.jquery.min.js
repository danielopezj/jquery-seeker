(function(i){var j=function(){};j.prototype.indexOf=function(d,a){var b;for(b=0;b<a.length;b++)if(j.prototype.deepEqual(a[b],d))return b;return-1};j.prototype.deepEqual=function(d,a){if(d===a)return!0;if(!(d instanceof Object)||!(a instanceof Object)||d.constructor!==a.constructor)return!1;for(var b in d)if(d.hasOwnProperty(b)&&(!a.hasOwnProperty(b)||d[b]!==a[b]&&("object"!==typeof d[b]||!j.prototype.deepEqual(d[b],a[b]))))return!1;for(b in a)if(a.hasOwnProperty(b)&&!d.hasOwnProperty(b))return!1;
return!0};j.prototype.clamp=function(d,a,b){return d<a?a:d>b?b:d};j.prototype.parseField=function(d,a){return 0===a||d.length<a?d:d.substring(0,a)+"..."};i.fn.seeker=function(d){var a,b,m,e,h,f,o,c,p,k,l;this.settings=i.extend({source:[],seekField:null,url:void 0,method:"POST",onSelected:void 0,visibleFields:[],order:"ASC",peerSeeker:null,width:200,autocompleteInterval:2E3,orderBy:void 0,maxFieldLength:0,dropDownSameWidth:!0},d);this.id=this.attr("id");this.source=[];this.filteredSource=[];this.selectedIndex=
-1;if(null===this.settings.seekField)throw"Seek Field not found";if(this.settings.source===[]&&void 0===this.settings.url)throw"Source not specified";this.getSelectedItem=function(){if(-1<this.selectedIndex)return this.source[this.selectedIndex]};this.setSelectedItem=function(g){var c,a,d;d=new j;c=d.indexOf(g,this.source);if(-1<c){a=this.source[c];this.val(a[this.settings.seekField]);this._buildTable(this.source);this.filteredSource=[];k&&clearInterval(k);if(this.settings.onSelected)this.settings.onSelected(c,
a);this.selectedIndex=c}a=b.parent().outerHeight()/2;b.parent().scrollTop(b.parent()[0].scrollHeight*(c/this.source.length)-a);b=i("#"+this.id+"-table").hide();this._buildTable(this.source);this.settings.peerSeeker&&!d.deepEqual(this.settings.peerSeeker.getSelectedItem(),g)&&this.settings.peerSeeker.setSelectedItem(g)};this.setSelectedIndex=function(g){this.source[g]&&this.setSelectedItem(this.source[g])};this.getSelectedIndex=function(){return this.selectedIndex};this.setPeerSeeker=function(g){this.settings.peerSeeker=
g};this.setSource=function(g){this.settings.source=g;this.source=[];this.selectedIndex=-1;for(a=0;a<this.settings.source.length;a++)this.source.push(this.settings.source[a]);this._buildTable(this.source);this.val("")};this._filterSource=function(g){var c,a;this.filteredSource=[];g=g.toLowerCase();for(c=0;c<this.source.length;c++)a=this.source[c][this.settings.seekField].toString().toLowerCase(),0===a.indexOf(g)&&this.filteredSource.push(this.source[c]);this._buildTable(this.filteredSource)};this._updateScroll=
function(c,a,b){var d=c.parent().outerHeight()/2;c.parent().scrollTop(c.parent()[0].scrollHeight*(a/b)-d)};this._buildTable=function(a){var b,d,e,f,h,k,l,n;n=new j;k=i("#"+this.id+"-table");k.empty();for(e=0;e<a.length;e++){b="<tr "+(-1<this.selectedIndex&&e===this.selectedIndex?'class="seeker-selected"':"")+' id="'+m+"-"+e+'">';d=a[e];if(0<this.settings.visibleFields.length)for(l in f=1,this.settings.visibleFields)d[this.settings.visibleFields[l]]&&(b+='<td class="col-'+f+'">'+n.parseField(d[this.settings.visibleFields[l]],
this.settings.maxFieldLength)+"</td>",f++);else for(h in b+='<td class="col-1">'+n.parseField(d[this.settings.seekField],this.settings.maxFieldLength)+"</td>",f=1,d)d[h]&&h!==this.settings.seekField&&(b+='<td class="col-'+f+'">'+n.parseField(d[h],this.settings.maxFieldLength)+"</td>",f++);b+="</tr>";k.append(b)}i("#"+m+"-table tr").bind("click",function(){var b=this.id.split("-")[1],b=0<c.filteredSource.length?c.filteredSource[b]:c.source[b];c.setSelectedItem(b);c.settings.peerSeeker&&c.settings.peerSeeker.setSelectedItem(b)})};
this._checkForAutocomplete=function(){var a,d,e=c.val();for(a=0;a<c.source.length;a++)if(d=c.source[a][c.settings.seekField].toString().toLowerCase(),0===d.indexOf(e)){a=c.source[a];c.setSelectedItem(a);c.settings.peerSeeker&&c.settings.peerSeeker.setSelectedItem(a);b.hide();break}};m=this.id;c=this;if(this.settings.url)i.ajax({type:this.settings.method,contentType:"application/json; charset=utf-8",url:this.settings.url,dataType:"json",async:!1,success:function(b){c.settings.source=b;c.source=b}});
else for(a=0;a<this.settings.source.length;a++)this.source.push(this.settings.source[a]);null!==this.settings.order&&(a=this.settings.orderBy||this.settings.seekField,p="DESC"===this.settings.order,this.source.sort(function(b,c){return b[a]===c[a]?0:p&&b[a]>c[a]||!p&&b[a]<c[a]?-1:1}));this.addClass("seeker-text");this.wrap('<div class="seeker-container" />');this.after('<div class="seeker-table-container"><table class="seeker-outter" id="'+m+'-table"></table></div>');this.css("width",this.settings.width);
b=i("#"+m+"-table");d=b.parent();this.settings.dropDownSameWidth&&b.width(this.width());this._buildTable(this.source);o=l=f=h=!1;this.after('<input type="button" value="" id="'+m+'-button" class="seeker-button" />');e=i("#"+m+"-button");this.bind("mouseenter",function(){f=true;e.show()});this.bind("mouseleave",function(){f=false;h||e.hide();l||b.hide()});this.bind("focus",function(){h=true;e.show()});this.bind("blur",function(){h=false;f||e.hide();if(o){o=false;b.hide()}});e.bind("mouseenter",function(){f=
true;e.show()});e.bind("mouseleave",function(){f=false;h||e.hide()});e.bind("click",function(){if(c.filteredSource.length>0){c.filteredSource=[];c._buildTable(c.source)}if(b.css("display")==="none"){b.show();c._updateScroll(b,c.selectedIndex,c.source.length)}else b.hide()});d.bind("mouseenter",function(){l=true;b.show()});d.bind("mouseleave",function(){l=false;!h&&!f&&b.hide()});this.bind("keyup",function(a){if(a.keyCode===40||a.keyCode===38){a=c.selectedIndex+(a.keyCode===40?1:-1);a=(new j).clamp(a,
0,c.source.length-1);c.setSelectedItem(c.source[a]);b.show();c._updateScroll(b,c.selectedIndex,c.source.length);c.settings.peerSeeker&&c.settings.peerSeeker.setSelectedItem(c.source[a])}else if(a.keyCode===13)b.hide();else{c._filterSource(i(this).val());b.show();if(c.settings.autocompleteInterval>0){k&&clearInterval(k);k=setInterval(c._checkForAutocomplete,c.settings.autocompleteInterval)}}});return this}})(jQuery);