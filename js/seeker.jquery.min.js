(function(j){j.fn.seeker=function(l){var f,k,e,i,g,n,d,h,o,m;this.settings=j.extend({source:[],seekField:null,url:void 0,method:"POST",onSelected:void 0,visibleFields:[],order:"ASC",peerSeeker:null,width:200,autocompleteInterval:1500},l);this.id=this.attr("id");this.source=[];this.filteredSource=[];this.indexOf=function(a,b){var c;for(c=0;c<b.length;c++)if(this.deepEqual(b[c],a))return c;return-1};this.deepEqual=function(a,b){if(a===b)return!0;if(!(a instanceof Object)||!(b instanceof Object)||a.constructor!==
b.constructor)return!1;for(var c in a)if(a.hasOwnProperty(c)&&(!b.hasOwnProperty(c)||a[c]!==b[c]&&("object"!==typeof a[c]||!this.deepEqual(a[c],b[c]))))return!1;for(c in b)if(b.hasOwnProperty(c)&&!a.hasOwnProperty(c))return!1;return!0};this.setSelectedIndex=function(a){var b,a=this.indexOf(a,this.source);if(-1<a&&(b=this.source[a],this.val(b[this.settings.seekField]),this._buildTable(this.source),this.filteredSource=[],m&&clearInterval(m),this.settings.onSelected))this.settings.onSelected(a,b);f=
j("#"+this.id+"-table").hide()};this.setPeerSeeker=function(a){this.settings.peerSeeker=a};this._filterSource=function(a){var b,c;this.filteredSource=[];a=a.toLowerCase();for(b=0;b<this.source.length;b++)c=this.source[b][this.settings.seekField].toString().toLowerCase(),0===c.indexOf(a)&&this.filteredSource.push(this.source[b]);this._buildTable(this.filteredSource)};this._buildTable=function(a){var b,c,e,f,g,h,i;h=j("#"+this.id+"-table");h.empty();for(e=0;e<a.length;e++){b='<tr id="'+k+"-"+e+'">';
c=a[e];console.log(c);if(0<this.settings.visibleFields.length)for(i in f=1,this.settings.visibleFields)c[this.settings.visibleFields[i]]&&(b+='<td class="col-'+f+'">'+c[this.settings.visibleFields[i]]+"</td>",f++);else for(g in b+='<td class="col-1">'+c[this.settings.seekField]+"</td>",f=1,c)c[g]&&g!==this.settings.seekField&&(b+='<td class="col-'+f+'">'+c[g]+"</td>",f++);b+="</tr>";h.append(b)}h.css("width",this.width()-20);j("#"+k+"-table tr").bind("click",function(){var a=this.id.split("-")[1],
a=0<d.filteredSource.length?d.filteredSource[a]:d.source[a];d.setSelectedIndex(a);d.settings.peerSeeker&&d.settings.peerSeeker.setSelectedIndex(a)})};this._checkForAutocomplete=function(){var a,b,c=d.val();for(a=0;a<d.source.length;a++)if(b=d.source[a][d.settings.seekField].toString().toLowerCase(),0===b.indexOf(c)){a=d.source[a];d.setSelectedIndex(a);d.settings.peerSeeker&&d.settings.peerSeeker.setSelectedIndex(a);f.hide();break}};k=this.id;d=this;if(this.settings.url)j.ajax({type:this.settings.method,
contentType:"application/json; charset=utf-8",url:this.settings.url,dataType:"json",async:!1,success:function(a){d.settings.source=a;d.source=a}});else for(l=0;l<this.settings.source.length;l++)this.source.push(this.settings.source[l]);null!==this.settings.order&&(h=this.settings.seekField,o="DESC"===this.settings.order,this.source.sort(function(a,b){return a[h]===b[h]?0:o&&a[h]>b[h]||!o&&a[h]<b[h]?-1:1}));this.addClass("seeker-text");this.wrap('<div class="seeker-container" />');this.after('<table class="seeker-outter" id="'+
k+'-table"></table>');this.css("width",this.settings.width);f=j("#"+k+"-table");this._buildTable(this.source);n=g=i=!1;this.after('<input type="button" value="" id="'+k+'-button" class="seeker-button" />');e=j("#"+k+"-button");this.bind("mouseenter",function(){g=true;e.show()});this.bind("mouseleave",function(){g=false;i||e.hide()});this.bind("focus",function(){i=true;e.show()});this.bind("blur",function(){i=false;g||e.hide();if(n){n=false;f.hide()}});e.bind("mouseenter",function(){g=true;e.show()});
e.bind("mouseleave",function(){g=false;i||e.hide()});e.bind("click",function(){if(d.filteredSource.length>0){d.filteredSource=[];d._buildTable(d.source)}f.show();n=true});f.bind("mouseleave",function(){!i&&!g&&f.hide()});this.bind("keyup",function(){d._filterSource(j(this).val());f.show();if(d.settings.autocompleteInterval>0){m&&clearInterval(m);m=setInterval(d._checkForAutocomplete,d.settings.autocompleteInterval)}});return this}})(jQuery);