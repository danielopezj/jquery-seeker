(function(i){var j=function(){};j.prototype.indexOf=function(d,a){var c;for(c=0;c<a.length;c++)if(j.prototype.deepEqual(a[c],d))return c;return-1};j.prototype.deepEqual=function(d,a){if(d===a)return!0;if(!(d instanceof Object)||!(a instanceof Object)||d.constructor!==a.constructor)return!1;for(var c in d)if(d.hasOwnProperty(c)&&(!a.hasOwnProperty(c)||d[c]!==a[c]&&("object"!==typeof d[c]||!j.prototype.deepEqual(d[c],a[c]))))return!1;for(c in a)if(a.hasOwnProperty(c)&&!d.hasOwnProperty(c))return!1;
return!0};j.prototype.clamp=function(d,a,c){return d<a?a:d>c?c:d};j.prototype.parseField=function(d,a){return 0===a||d.length<a?d:d.substring(0,a)+"..."};i.fn.seeker=function(d){var a,c,m,e,h,g,k,b,n,l;this.settings=i.extend({source:[],seekField:null,url:void 0,method:"POST",onSelected:void 0,visibleFields:[],order:"ASC",peerSeeker:null,width:200,autocompleteInterval:2E3,orderBy:void 0,maxFieldLength:0},d);this.id=this.attr("id");this.source=[];this.filteredSource=[];this.selectedIndex=-1;this.setSelectedIndex=
function(f){var b,f=(new j).indexOf(f,this.source);if(-1<f){b=this.source[f];this.val(b[this.settings.seekField]);this._buildTable(this.source);this.filteredSource=[];l&&clearInterval(l);if(this.settings.onSelected)this.settings.onSelected(f,b);this.selectedIndex=f}c=i("#"+this.id+"-table").hide();this._buildTable(this.source)};this.setPeerSeeker=function(f){this.settings.peerSeeker=f};this._filterSource=function(f){var b,a;this.filteredSource=[];f=f.toLowerCase();for(b=0;b<this.source.length;b++)a=
this.source[b][this.settings.seekField].toString().toLowerCase(),0===a.indexOf(f)&&this.filteredSource.push(this.source[b]);this._buildTable(this.filteredSource)};this._buildTable=function(f){var a,c,d,e,g,h,l,k;k=new j;h=i("#"+this.id+"-table");h.empty();for(d=0;d<f.length;d++){a="<tr "+(-1<this.selectedIndex&&d===this.selectedIndex?'class="seeker-selected"':"")+' id="'+m+"-"+d+'">';c=f[d];if(0<this.settings.visibleFields.length)for(l in e=1,this.settings.visibleFields)c[this.settings.visibleFields[l]]&&
(a+='<td class="col-'+e+'">'+k.parseField(c[this.settings.visibleFields[l]],this.settings.maxFieldLength)+"</td>",e++);else for(g in a+='<td class="col-1">'+k.parseField(c[this.settings.seekField],this.settings.maxFieldLength)+"</td>",e=1,c)c[g]&&g!==this.settings.seekField&&(a+='<td class="col-'+e+'">'+k.parseField(c[g],this.settings.maxFieldLength)+"</td>",e++);a+="</tr>";h.append(a)}h.css("width",this.width()-20);i("#"+m+"-table tr").bind("click",function(){var a=this.id.split("-")[1],a=0<b.filteredSource.length?
b.filteredSource[a]:b.source[a];b.setSelectedIndex(a);b.settings.peerSeeker&&b.settings.peerSeeker.setSelectedIndex(a)})};this._checkForAutocomplete=function(){var a,d,e=b.val();for(a=0;a<b.source.length;a++)if(d=b.source[a][b.settings.seekField].toString().toLowerCase(),0===d.indexOf(e)){a=b.source[a];b.setSelectedIndex(a);b.settings.peerSeeker&&b.settings.peerSeeker.setSelectedIndex(a);c.hide();break}};m=this.id;b=this;if(this.settings.url)i.ajax({type:this.settings.method,contentType:"application/json; charset=utf-8",
url:this.settings.url,dataType:"json",async:!1,success:function(a){b.settings.source=a;b.source=a}});else for(a=0;a<this.settings.source.length;a++)this.source.push(this.settings.source[a]);null!==this.settings.order&&(a=this.settings.orderBy||this.settings.seekField,n="DESC"===this.settings.order,this.source.sort(function(b,c){return b[a]===c[a]?0:n&&b[a]>c[a]||!n&&b[a]<c[a]?-1:1}));this.addClass("seeker-text");this.wrap('<div class="seeker-container" />');this.after('<div class="seeker-table-container"><table class="seeker-outter" id="'+
m+'-table"></table></div>');this.css("width",this.settings.width);c=i("#"+m+"-table");this._buildTable(this.source);k=g=h=!1;this.after('<input type="button" value="" id="'+m+'-button" class="seeker-button" />');e=i("#"+m+"-button");this.bind("mouseenter",function(){g=true;e.show()});this.bind("mouseleave",function(){g=false;h||e.hide()});this.bind("focus",function(){h=true;e.show()});this.bind("blur",function(){h=false;g||e.hide();if(k){k=false;c.hide()}});e.bind("mouseenter",function(){g=true;e.show()});
e.bind("mouseleave",function(){g=false;h||e.hide()});e.bind("click",function(){if(b.filteredSource.length>0){b.filteredSource=[];b._buildTable(b.source)}c.show();k=true});c.bind("mouseleave",function(){!h&&!g&&c.hide()});this.bind("keyup",function(a){if(a.keyCode===40||a.keyCode===38){a=b.selectedIndex+(a.keyCode===40?1:-1);a=(new j).clamp(a,0,b.source.length-1);b.setSelectedIndex(b.source[a]);c.show();b.settings.peerSeeker&&b.settings.peerSeeker.setSelectedIndex(b.source[a])}else if(a.keyCode===
13)c.hide();else{b._filterSource(i(this).val());c.show();if(b.settings.autocompleteInterval>0){l&&clearInterval(l);l=setInterval(b._checkForAutocomplete,b.settings.autocompleteInterval)}}});return this}})(jQuery);