(function(j){var g=function(){};g.prototype.indexOf=function(d,b){var a;for(a=0;a<b.length;a++)if(g.prototype.deepEqual(b[a],d))return a;return-1};g.prototype.deepEqual=function(d,b){if(d===b)return!0;if(!(d instanceof Object)||!(b instanceof Object)||d.constructor!==b.constructor)return!1;for(var a in d)if(d.hasOwnProperty(a)&&(!b.hasOwnProperty(a)||d[a]!==b[a]&&("object"!==typeof d[a]||!g.prototype.deepEqual(d[a],b[a]))))return!1;for(a in b)if(b.hasOwnProperty(a)&&!d.hasOwnProperty(a))return!1;
return!0};g.prototype.clamp=function(d,b,a){return d<b?b:d>a?a:d};j.fn.seeker=function(d){var b,a,k,f,i,h,m,c,n,l;this.settings=j.extend({source:[],seekField:null,url:void 0,method:"POST",onSelected:void 0,visibleFields:[],order:"ASC",peerSeeker:null,width:200,autocompleteInterval:2E3,orderBy:void 0},d);this.id=this.attr("id");this.source=[];this.filteredSource=[];this.selectedIndex=-1;this.setSelectedIndex=function(e){var c,e=(new g).indexOf(e,this.source);if(-1<e){c=this.source[e];this.val(c[this.settings.seekField]);
this._buildTable(this.source);this.filteredSource=[];l&&clearInterval(l);if(this.settings.onSelected)this.settings.onSelected(e,c);this.selectedIndex=e}a=j("#"+this.id+"-table").hide();this._buildTable(this.source)};this.setPeerSeeker=function(e){this.settings.peerSeeker=e};this._filterSource=function(e){var c,a;this.filteredSource=[];e=e.toLowerCase();for(c=0;c<this.source.length;c++)a=this.source[c][this.settings.seekField].toString().toLowerCase(),0===a.indexOf(e)&&this.filteredSource.push(this.source[c]);
this._buildTable(this.filteredSource)};this._buildTable=function(e){var a,b,d,f,g,h,i;h=j("#"+this.id+"-table");h.empty();for(d=0;d<e.length;d++){a="<tr "+(-1<this.selectedIndex&&d==this.selectedIndex?'class="seeker-selected"':"")+' id="'+k+"-"+d+'">';b=e[d];if(0<this.settings.visibleFields.length)for(i in f=1,this.settings.visibleFields)b[this.settings.visibleFields[i]]&&(a+='<td class="col-'+f+'">'+b[this.settings.visibleFields[i]]+"</td>",f++);else for(g in a+='<td class="col-1">'+b[this.settings.seekField]+
"</td>",f=1,b)b[g]&&g!==this.settings.seekField&&(a+='<td class="col-'+f+'">'+b[g]+"</td>",f++);a+="</tr>";h.append(a)}h.css("width",this.width()-20);j("#"+k+"-table tr").bind("click",function(){var a=this.id.split("-")[1],a=0<c.filteredSource.length?c.filteredSource[a]:c.source[a];c.setSelectedIndex(a);c.settings.peerSeeker&&c.settings.peerSeeker.setSelectedIndex(a)})};this._checkForAutocomplete=function(){var e,b,d=c.val();for(e=0;e<c.source.length;e++)if(b=c.source[e][c.settings.seekField].toString().toLowerCase(),
0===b.indexOf(d)){e=c.source[e];c.setSelectedIndex(e);c.settings.peerSeeker&&c.settings.peerSeeker.setSelectedIndex(e);a.hide();break}};k=this.id;c=this;if(this.settings.url)j.ajax({type:this.settings.method,contentType:"application/json; charset=utf-8",url:this.settings.url,dataType:"json",async:!1,success:function(a){c.settings.source=a;c.source=a}});else for(b=0;b<this.settings.source.length;b++)this.source.push(this.settings.source[b]);null!==this.settings.order&&(b=this.settings.orderBy||this.settings.seekField,
n="DESC"===this.settings.order,this.source.sort(function(a,c){return a[b]===c[b]?0:n&&a[b]>c[b]||!n&&a[b]<c[b]?-1:1}));this.addClass("seeker-text");this.wrap('<div class="seeker-container" />');this.after('<div class="seeker-table-container"><table class="seeker-outter" id="'+k+'-table"></table></div>');this.css("width",this.settings.width);a=j("#"+k+"-table");this._buildTable(this.source);m=h=i=!1;this.after('<input type="button" value="" id="'+k+'-button" class="seeker-button" />');f=j("#"+k+"-button");
this.bind("mouseenter",function(){h=true;f.show()});this.bind("mouseleave",function(){h=false;i||f.hide()});this.bind("focus",function(){i=true;f.show()});this.bind("blur",function(){i=false;h||f.hide();if(m){m=false;a.hide()}});f.bind("mouseenter",function(){h=true;f.show()});f.bind("mouseleave",function(){h=false;i||f.hide()});f.bind("click",function(){if(c.filteredSource.length>0){c.filteredSource=[];c._buildTable(c.source)}a.show();m=true});a.bind("mouseleave",function(){!i&&!h&&a.hide()});this.bind("keyup",
function(b){if(b.keyCode===40||b.keyCode===38){b=c.selectedIndex+(b.keyCode===40?1:-1);b=(new g).clamp(b,0,c.source.length-1);c.setSelectedIndex(c.source[b]);a.show();c.settings.peerSeeker&&c.settings.peerSeeker.setSelectedIndex(c.source[b])}else if(b.keyCode===13)a.hide();else{c._filterSource(j(this).val());a.show();if(c.settings.autocompleteInterval>0){l&&clearInterval(l);l=setInterval(c._checkForAutocomplete,c.settings.autocompleteInterval)}}});return this}})(jQuery);